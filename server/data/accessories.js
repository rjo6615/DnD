const { EQUIPMENT_SLOT_LAYOUT } = require('../constants/equipmentSlots');

const categories = [
  'amulet',
  'belt',
  'bracelet',
  'brooch',
  'cape',
  'cloak',
  'goggles',
  'mask',
  'ring',
  'sash',
  'wrap',
];

const slotKeys = ['eyes', 'wrists', 'neck', 'waist', 'back', 'ringLeft', 'ringRight'];

const slotMap = new Map(EQUIPMENT_SLOT_LAYOUT.flat().map((slot) => [slot.key, slot]));

const slots = slotKeys.map((key) => slotMap.get(key) || { key, label: key });

/**
 * @typedef {Object} Accessory
 * @property {string} name
 * @property {string} category
 * @property {string[]} targetSlots
 * @property {string} [rarity]
 * @property {string} [attunement]
 * @property {string|number} [weight]
 * @property {string|number} [cost]
 * @property {Record<string, number>} [statBonuses]
 * @property {Record<string, number>} [skillBonuses]
 * @property {string} [notes]
 */

/** @type {Record<string, Accessory>} */
const accessories = {
  'amulet-of-health': {
    name: 'Amulet of Health',
    category: 'amulet',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['neck'],
    weight: '',
    cost: '',
    notes: 'While attuned to this amulet, your Constitution score is 19.',
  },
  'amulet-of-proof-against-detection-and-location': {
    name: 'Amulet of Proof against Detection and Location',
    category: 'amulet',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['neck'],
    weight: '',
    cost: '',
    notes: 'While wearing this amulet, you are hidden from divination magic and cannot be targeted by magical scrying sensors.',
  },
  'amulet-of-the-planes': {
    name: 'Amulet of the Planes',
    category: 'amulet',
    rarity: 'very rare',
    attunement: 'requires attunement',
    targetSlots: ['neck'],
    weight: '',
    cost: '',
    notes: 'While wearing this amulet, you can use an action to cast the plane shift spell (self only). A failed Intelligence check can cause a mishap.',
  },
  'periapt-of-proof-against-poison': {
    name: 'Periapt of Proof against Poison',
    category: 'amulet',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['neck'],
    weight: '',
    cost: '',
    notes: 'You are immune to poison damage and the poisoned condition while attuned to this periapt.',
  },
  'periapt-of-wound-closure': {
    name: 'Periapt of Wound Closure',
    category: 'amulet',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['neck'],
    weight: '',
    cost: '',
    notes: 'While wearing this periapt, you stabilize whenever you are dying at the start of your turn and you double hit points restored by hit dice.',
  },
  'belt-of-dwarvenkind': {
    name: 'Belt of Dwarvenkind',
    category: 'belt',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['waist'],
    weight: '',
    cost: '',
    statBonuses: { con: 2 },
    notes: 'While attuned, you gain dwarven resilience, advantage on Charisma (Persuasion) checks made to interact with dwarves, and a 50% chance of growing a full beard each dawn if you can grow one.',
  },
  'belt-of-hill-giant-strength': {
    name: 'Belt of Hill Giant Strength',
    category: 'belt',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['waist'],
    weight: '',
    cost: '',
    notes: 'While wearing this belt, your Strength score is 21.',
  },
  'belt-of-stone-giant-strength': {
    name: 'Belt of Stone Giant Strength',
    category: 'belt',
    rarity: 'very rare',
    attunement: 'requires attunement',
    targetSlots: ['waist'],
    weight: '',
    cost: '',
    notes: 'While wearing this belt, your Strength score is 23.',
  },
  'bracers-of-archery': {
    name: 'Bracers of Archery',
    category: 'bracelet',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['wrists'],
    weight: '',
    cost: '',
    notes: 'You have proficiency with longbows and shortbows, and you gain a +2 bonus to damage rolls on attacks made with them.',
  },
  'bracers-of-defense': {
    name: 'Bracers of Defense',
    category: 'bracelet',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['wrists'],
    weight: '',
    cost: '',
    notes: 'While wearing these bracers and no armor or shield, you gain a +2 bonus to AC.',
  },
  'brooch-of-shielding': {
    name: 'Brooch of Shielding',
    category: 'brooch',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['neck'],
    weight: '',
    cost: '',
    notes: 'While wearing this brooch, you have resistance to force damage and immunity to the magic missile spell.',
  },
  'cape-of-the-mountebank': {
    name: 'Cape of the Mountebank',
    category: 'cape',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['back'],
    weight: '',
    cost: '',
    notes: 'While wearing this cape, you can use an action to cast the dimension door spell. The cape recreates a billowing effect when the spell is used.',
  },
  'cloak-of-elvenkind': {
    name: 'Cloak of Elvenkind',
    category: 'cloak',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['back'],
    weight: '',
    cost: '',
    notes: 'While wearing this cloak with its hood up, Wisdom (Perception) checks made to see you have disadvantage, and you have advantage on Dexterity (Stealth) checks made to hide.',
  },
  'cloak-of-protection': {
    name: 'Cloak of Protection',
    category: 'cloak',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['back'],
    weight: '',
    cost: '',
    notes: 'While wearing this cloak, you gain a +1 bonus to AC and saving throws.',
  },
  'cloak-of-the-bat': {
    name: 'Cloak of the Bat',
    category: 'cloak',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['back'],
    weight: '',
    cost: '',
    notes: 'While wearing this cloak, you have advantage on Dexterity (Stealth) checks and can use it to fly in dim light or darkness when both hands are free.',
  },
  'cloak-of-the-manta-ray': {
    name: 'Cloak of the Manta Ray',
    category: 'cloak',
    rarity: 'uncommon',
    targetSlots: ['back'],
    weight: '',
    cost: '',
    notes: 'While wearing this cloak, you can breathe underwater and have a swimming speed of 60 feet.',
  },
  'eyes-of-charming': {
    name: 'Eyes of Charming',
    category: 'goggles',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['eyes'],
    weight: '',
    cost: '',
    notes: 'While wearing these crystal lenses, you can cast the charm person spell three times per day (DC 13).',
  },
  'eyes-of-the-eagle': {
    name: 'Eyes of the Eagle',
    category: 'goggles',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['eyes'],
    weight: '',
    cost: '',
    notes: 'Wearing these lenses grants advantage on Wisdom (Perception) checks that rely on sight, and you can see up to 1 mile clearly.',
  },
  'goggles-of-night': {
    name: 'Goggles of Night',
    category: 'goggles',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['eyes'],
    weight: '',
    cost: '',
    notes: 'While wearing these goggles, you have darkvision out to a range of 60 feet (or an additional 60 feet if you already have darkvision).',
  },
  'ring-of-feather-falling': {
    name: 'Ring of Feather Falling',
    category: 'ring',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['ringLeft', 'ringRight'],
    weight: '',
    cost: '',
    notes: 'This ring activates to cast feather fall on you when you fall 20 feet or more while wearing it.',
  },
  'ring-of-free-action': {
    name: 'Ring of Free Action',
    category: 'ring',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['ringLeft', 'ringRight'],
    weight: '',
    cost: '',
    notes: 'While wearing this ring, difficult terrain does not cost you extra movement, and magic cannot reduce your speed or cause you to be paralyzed or restrained.',
  },
  'ring-of-invisibility': {
    name: 'Ring of Invisibility',
    category: 'ring',
    rarity: 'legendary',
    attunement: 'requires attunement',
    targetSlots: ['ringLeft', 'ringRight'],
    weight: '',
    cost: '',
    notes: 'While wearing this ring, you can turn invisible. The effect ends if the ring is removed, if you attack, or if you cast a spell.',
  },
  'ring-of-protection': {
    name: 'Ring of Protection',
    category: 'ring',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['ringLeft', 'ringRight'],
    weight: '',
    cost: '',
    notes: 'While wearing this ring, you gain a +1 bonus to AC and saving throws.',
  },
  'ring-of-regeneration': {
    name: 'Ring of Regeneration',
    category: 'ring',
    rarity: 'very rare',
    attunement: 'requires attunement',
    targetSlots: ['ringLeft', 'ringRight'],
    weight: '',
    cost: '',
    notes: 'While wearing this ring, you regain 1d6 hit points every 10 minutes if you have at least 1 hit point, and you can regrow lost body parts.',
  },
  'ring-of-spell-storing': {
    name: 'Ring of Spell Storing',
    category: 'ring',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['ringLeft', 'ringRight'],
    weight: '',
    cost: '',
    notes: 'This ring stores up to 5 levels worth of spells that can be cast later by the wearer.',
  },
  'ring-of-water-walking': {
    name: 'Ring of Water Walking',
    category: 'ring',
    rarity: 'uncommon',
    targetSlots: ['ringLeft', 'ringRight'],
    weight: '',
    cost: '',
    notes: 'While wearing this ring, you can stand and move across liquid surfaces as if they were solid ground.',
  },
  'ring-of-warmth': {
    name: 'Ring of Warmth',
    category: 'ring',
    rarity: 'uncommon',
    attunement: 'requires attunement',
    targetSlots: ['ringLeft', 'ringRight'],
    weight: '',
    cost: '',
    notes: 'While wearing this ring, you have resistance to cold damage and are comfortable in temperatures as low as -50 degrees Fahrenheit.',
  },
  'robe-of-eyes': {
    name: 'Robe of Eyes',
    category: 'wrap',
    rarity: 'rare',
    attunement: 'requires attunement',
    targetSlots: ['back'],
    weight: '',
    cost: '',
    notes: 'This robe lets you see in all directions and grants darkvision and the ability to see invisible and ethereal creatures, but averting your eyes imposes disadvantage on attack rolls and Perception checks.',
  },
  'scarab-of-protection': {
    name: 'Scarab of Protection',
    category: 'brooch',
    rarity: 'legendary',
    attunement: 'requires attunement',
    targetSlots: ['neck'],
    weight: '',
    cost: '',
    notes: 'This jewel protects you from necrotic damage and drains the life from cursed mummies. It has 12 charges that can negate necromancy spells targeting you.',
  },
};

module.exports = {
  categories,
  slots,
  slotKeys,
  accessories,
};
